# Room Reservation

## Описание

Room Reservation — это современный асинхронный API-сервис для бронирования переговорных комнат. Проект реализован на FastAPI с использованием асинхронного SQLAlchemy и SQLite (по умолчанию). Система позволяет:

- Регистрировать и аутентифицировать пользователей (JWT, FastAPI Users)
- Создавать, просматривать, редактировать и удалять переговорные комнаты (CRUD, только для суперпользователей)
- Бронировать комнаты с учётом пересечений по времени (валидация на уровне API)
- Просматривать свои и все бронирования (все — только для суперпользователей)
- Управлять ролями пользователей (обычный пользователь/суперпользователь)
- Автоматически создавать первого суперпользователя при запуске (если заданы переменные окружения)

## Технологии
- Python 3.10+
- FastAPI
- SQLAlchemy (async)
- SQLite (по умолчанию)
- Alembic (миграции)
- Pydantic
- FastAPI Users (JWT-аутентификация)

## Быстрый старт

1. Клонируйте репозиторий:
   ```bash
   git clone git@github.com:AndreyZherdetskiy/room_reservation.git
   cd room_reservation
   ```
2. Скопируйте пример переменных окружения и настройте свой `.env`:
   ```bash
   cp '.env.example' .env
   # или создайте вручную и заполните переменные ниже
   ```
3. Установите зависимости:
   ```bash
   python3.10 -m venv venv
   source venv/bin/activate
   pip install -r requirements.txt
   ```
4. Примените миграции:
   ```bash
   alembic upgrade head
   ```
5. Запустите приложение:
   ```bash
   uvicorn app.main:app --reload
   ```
6. API будет доступен по адресу: [http://localhost:8000/docs](http://localhost:8000/docs) (OpenAPI Swagger UI)

## Структура репозитория

```
app/                # Основной backend-приложения (FastAPI, бизнес-логика, модели, схемы, CRUD, API)
├── main.py         # Точка входа в приложение FastAPI
├── core/           # Конфигурация, настройки, инициализация БД, управление пользователями
├── api/            # Роутеры, эндпоинты, валидация запросов
├── models/         # Описания ORM-моделей (MeetingRoom, Reservation, User)
├── schemas/        # Pydantic-схемы для валидации и сериализации данных
├── crud/           # CRUD-операции для моделей

alembic/            # Миграции Alembic для управления схемой БД
├── versions/       # Файлы миграций
alembic.ini         # Конфигурация Alembic

.env                # Переменные окружения (создаётся вручную, не хранится в репозитории)
README.md           # Описание и документация проекта
requirements.txt    # Список зависимостей Python
.gitignore          # Исключения для git (venv, .env, fastapi.db и др.)
```

**Кратко о содержимом:**
- **app/** — вся логика приложения: API, бизнес-правила, модели, схемы, CRUD, настройки.
- **alembic/** — миграции для обновления структуры базы данных.
- **alembic.ini** — настройки Alembic.
- **.env** — переменные окружения (БД, секреты, суперпользователь).
- **requirements.txt** — зависимости для установки через pip.
- **.gitignore** — файлы и папки, которые не попадут в git (секреты, окружение, база и др.).
- **fastapi.db** — файл SQLite-базы данных (локально, не хранится в git).
- **README.md** — подробная документация по проекту, запуску и API.

## Переменные окружения

- `APP_TITLE` — название приложения (опционально)
- `DATABASE_URL` — строка подключения к БД (по умолчанию: sqlite+aiosqlite:///./fastapi.db)
- `DESCRIPTION` — описание приложения (опционально)
- `SECRET` — секретный ключ для JWT
- `FIRST_SUPERUSER_EMAIL` — email первого суперпользователя (опционально)
- `FIRST_SUPERUSER_PASSWORD` — пароль первого суперпользователя (опционально)

## Основные команды

- Установка зависимостей: `pip install -r requirements.txt`
- Применение миграций: `alembic upgrade head`
- Запуск приложения: `uvicorn app.main:app --reload`
- Создание суперпользователя: автоматически при запуске, если заданы переменные

## Документация API

Полная OpenAPI-документация с примерами запросов и ответов, а также ошибками, доступна по адресу: [http://localhost:8000/docs](http://localhost:8000/docs)

### Основные эндпоинты

#### Аутентификация и пользователи

- `POST /auth/jwt/login` — вход по JWT (тело: email, пароль)
- `POST /auth/register` — регистрация пользователя
- `GET /users/me` — получить данные текущего пользователя

#### Переговорные комнаты (только для суперпользователей)

- `POST /meeting_rooms/` — создать комнату
- `GET /meeting_rooms/` — получить список всех комнат
- `PATCH /meeting_rooms/{id}` — обновить комнату
- `DELETE /meeting_rooms/{id}` — удалить комнату
- `GET /meeting_rooms/{id}/reservations` — получить будущие бронирования по комнате

#### Бронирования

- `POST /reservations/` — создать бронирование (валидация пересечений)
- `GET /reservations/` — получить все бронирования (только для суперпользователей)
- `GET /reservations/my_reservations` — получить свои бронирования
- `PATCH /reservations/{id}` — обновить бронирование (только владелец или суперпользователь)
- `DELETE /reservations/{id}` — удалить бронирование (только владелец или суперпользователь)

## Безопасность

- Все пароли хранятся в хэшированном виде
- JWT-аутентификация
- Валидация всех входных данных через Pydantic
- Ограничение доступа к административным операциям (только для суперпользователей)
- Переменные окружения для всех секретов

## Авторы
- [Andrey Zherdetskiy](https://github.com/AndreyZherdetskiy)

## Лицензия
MIT
